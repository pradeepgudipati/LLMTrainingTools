<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Include Tailwind CSS from CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.ckeditor.com/4.16.0/standard/ckeditor.js"></script>

    <title>LLM Training Tools</title>
    <style src="{{ url_for('static', filename='css/styles.css') }}"></style>
</head>
<body class="bg-gray-100">


<nav class="bg-white border-gray-200 dark:bg-gray-900">
    <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
        <a href="https://flowbite.com/" class="flex items-center space-x-3 rtl:space-x-reverse">
            <img src="{{ url_for('static', filename='res/logo.png') }}" class="h-8" alt="Logo"/>
            <span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white">LLM Training Tools </span>
        </a>
        <button data-collapse-toggle="navbar-default" type="button"
                class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
                aria-controls="navbar-default" aria-expanded="false">
            <span class="sr-only">Menu</span>
            <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M1 1h15M1 7h15M1 13h15"/>
            </svg>
        </button>
        <div class="hidden w-full md:block md:w-auto" id="navbar-default">
            <ul class="font-medium flex flex-col p-4 md:p-0 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 rtl:space-x-reverse md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700">
                <li>
                    <a id="import-csv-link"
                       class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">CSV
                        to JSONL</a>
                </li>
                <li>
                    <a id="import-jsonl-link"
                       class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">
                        Import JSONL to DB</a>
                </li>
                <li>
                    <a href="{{ url_for('export_jsonl') }}"
                       class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">
                        Export to JSONL</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- This is the file upload form that will be displayed when the "Import JSONL to DB" button is clicked -->
<div id="import-jsonl-form" style="display: none;">
    <form action="{{ url_for('jsonl_to_sqlite') }}" method="post" enctype="multipart/form-data">
        <input type="file" name="file" accept=".jsonl">
        <input type="submit" value="Upload">
    </form>
</div>
<div class="container mx-auto px-4">
    <!-- Flex container for both forms -->
    <div class="flex justify-end mt-4 space-x-4">

        <!-- Add Row Form -->
        <div class="flex justify-end mt-4">
            <button id="add-row-btn"
                    class="px-4 py-1 text-white bg-green-500 rounded hover:bg-green-600">
                Add New QA Pair
            </button>
        </div>

        <!-- Go to Page Form -->
        <form action="{{ url_for('index') }}" method="get" class="flex items-center">
            <label for="page-number" class="mr-2">Go to page:</label>
            <input type="number" id="page-number" name="page"
                   value="{{ request.args.get('page', default=session.get('page', 1)) }}" min="1" max="{{ data.pages }}"
                   class="px-2 py-1 border rounded" required>
            <button type="submit" class="ml-2 px-4 py-1 text-white bg-blue-500 rounded hover:bg-blue-600">Go</button>
        </form>

        <!-- Rows Per Page Form -->
        <form action="{{ url_for('index') }}" method="get" class="flex items-center">
            <label for="rows-per-page" class="mr-2">Rows per page:</label>
            <input type="number" id="rows-per-page" name="per_page" min="1" class="px-2 py-1 border rounded"
                   value="{{ request.args.get('per_page', default=session.get('per_page', 20)) }}" required>
            <button type="submit" class="ml-2 px-4 py-1 text-white bg-blue-500 rounded hover:bg-blue-600">Set</button>
        </form>

    </div>
    <div class="flex justify-end mt-4 space-x-4">
        <!-- Search Form -->
        <div class="flex justify-end mt-4">
            <form action="{{ url_for('index') }}" method="get" class="flex items-center">
                <input type="text" id="search-qa-query" name="query-qa" placeholder="Search Questions ..."
                       class="px-2 py-1 border rounded" value="{{ query_qa }}">
                <button type="submit" class="ml-2 px-4 py-1 text-white bg-blue-500 rounded hover:bg-blue-600">Search
                    Questions
                </button>
            </form>
        </div>
        <div class="flex justify-end mt-4">
            <form action="{{ url_for('index') }}" method="get" class="flex items-center">
                <input type="text" id="search-ans-query" name="query-ans" placeholder="Search Answers ..."
                       class="px-2 py-1 border rounded" value="{{ query_ans }}">
                <button type="submit" class="ml-2 px-4 py-1 text-white bg-blue-500 rounded hover:bg-blue-600">Search
                    Answers
                </button>
            </form>
            <form action="{{ url_for('index') }}" method="get" class="flex items-center">
                <!-- Hidden inputs to reset search queries and set page to 1 -->
                <input type="hidden" name="query-qa" value="">
                <input type="hidden" name="query-ans" value="">
                <input type="hidden" name="page" value="1">
                <button type="submit" class="ml-2 px-4 py-1 text-white bg-red-500 rounded hover:bg-red-600">Clear
                    Search
                </button>
            </form>
        </div>
    </div>
    <!-- Popup Form for New Row -->
    <div id="new-row-popup"
         class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white popup-custom-width">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Add New Question and Answer</h3>
                <div class="mt-xl-3 px-7 py-3">
                    <input type="text" id="new-question" placeholder="Enter question"
                           class="mb-3 px-2 py-1 border rounded w-full"/>
                    <textarea id="new-answer" placeholder="Enter answer"
                              class="mb-3 px-2 py-1 border rounded w-full"></textarea>

                </div>
                <div class="items-center px-4 py-3">
                    <button id="cancel-btn" class="px-4 py-1 text-white bg-gray-500 rounded hover:bg-gray-600 mr-2">
                        Cancel
                    </button>
                    <button id="save-btn" class="px-4 py-1 text-white bg-blue-500 rounded hover:bg-blue-600">Save
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Popup Form for Upload file -->
    <div id="upload-file-popup" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white popup-custom-width">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Upload File</h3>
                <span id="file-name" class="hidden text-lg font-medium text-gray-900 dark:text-white"></span>
                <span id="file-error" class="hidden text-lg font-medium text-red-900 dark:text-white"></span>
                <div id="drop-zone" class="mt-xl-3 px-7 py-3">
                    <label for="dropzone-file"
                           class="flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-bray-800 dark:bg-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:hover:border-gray-500 dark:hover:bg-gray-600">
                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                            <svg class="w-8 h-8 mb-4 text-gray-500 dark:text-gray-400" aria-hidden="true"
                                 xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                      stroke-width="2"
                                      d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                            </svg>
                            <p class="mb-2 text-sm text-gray-500 dark:text-gray-400"><span class="font-semibold">Click to upload</span>
                                or drag and drop</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">CSV / JSONL</p>
                        </div>
                        <input id="dropzone-file" type="file" class="hidden" accept=".csv, .jsonl"/>
                    </label>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="cancel-upload-btn"
                            class="px-4 py-1 text-white bg-gray-500 rounded hover:bg-gray-600 mr-2">Cancel
                    </button>
                    <button id="upload-btn" class="px-4 py-1 text-white bg-blue-500 rounded hover:bg-blue-600">Upload
                    </button>
                    <button id="reset-btn" class="hidden px-4 py-1 text-white bg-red-500 rounded hover:bg-red-600">
                        Reset
                    </button>
                    <button id="process-btn" class="hidden px-4 py-1 text-white bg-blue-500 rounded hover:bg-blue-600">
                        Process
                    </button>

                </div>
            </div>
        </div>
    </div>


    <h1 class="text-xl font-bold my-4">LLM Training Data</h1>
    <div>
        <p>
            {% if count > 0 %}
                Total Q&A Pairs: {{ count }}
            {% else %}
                No Q&A pairs available.
            {% endif %}
        </p>


    </div>
    <div class="bg-white shadow-md rounded my-6 overflow-x-auto">
        <table id="qa-table" class="min-w-full leading-normal custom-table-layout">
            <thead>
            <tr>
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider col-id">
                    ID
                </th>
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider col-question">
                    Question
                </th>
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider col-answer">
                    Answer
                </th>
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider col-action">
                    Action
                </th>
            </tr>
            </thead>
            <tbody>
            {% for item in data %}
                <tr>
                    <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm col-id">
                        <div class="flex items-center">
                            {{ item.id }}
                        </div>
                    </td>
                    <td id="question-{{ item.id }}"
                        class="px-5 py-5 border-b border-gray-200 bg-white text-sm col-question">
                        <div class="flex items-center" contenteditable="false">
                            {{ item.user | safe }}
                        </div>
                    </td>
                    <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm col-answer">
                        <div class="html-content" id="content-{{ item.id }}" contenteditable="false">
                            {{ item.assistant | safe }}
                        </div>
                    </td>

                    <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm col-action">
                        <div class="flex justify-around items-center h-auto">
                            <button id="edit-q-btn-{{ item.id }}" onclick="toggleQuestionEditor({{ item.id }})"
                                    class="text-green-500 hover:text-green-800">
                                <img src="{{ url_for('static', filename='res/questionEditIcon.svg') }}"
                                     alt="Question Edit icon"/>
                                <span>Edit Q</span>
                            </button>
                            <div>&nbsp &nbsp</div>

                            <button id="edit-a-btn-{{ item.id }}" onclick="toggleAnswerEditor({{ item.id }})"
                                    class="text-purple-500 hover:text-purple-900">
                                <img src="{{ url_for('static', filename='res/answerEditIcon.svg') }}"
                                     alt="Answer Edit icon"/>
                                <span>Edit A</span>
                            </button>


                            <!-- Delete Button with Red Cross SVG -->
                            <button id="delete-btn-{{ item.id }}" onclick="deleteQAPair({{ item.id }})"
                                    class="text-red-500 hover:text-red-800" style="margin-left: 10px">
                                <img src="{{ url_for('static', filename='res/deleteIcon.svg') }}"
                                     alt="Delete icon"/>
                                <span>Delete Row</span>
                            </button>
                        </div>

                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <div class="flex justify-end mt-4">
            {% if data.has_prev %}
                <a href="{{ url_for('index', page=data.prev_num) }}?per_page={{ session.get('per_page', 20) }}"
                   class="px-4 py-2 text-sm text-blue-500">Prev</a>
            {% endif %}
            {% for p in data.iter_pages() %}
                {% if p %}
                    <a href="{{ url_for('index', page=p, per_page=session.get('per_page', 20)) }}"
                       class="px-4 py-2 text-sm {{ 'font-bold' if p == data.page else 'text-blue-500' }}">{{ p }}</a>
                {% else %}
                    <span class="px-4 py-2 text-sm text-gray-500">...</span>
                {% endif %}
            {% endfor %}
            {% if data.has_next %}
                <a href="{{ url_for('index', page=data.next_num) }}?per_page={{ session.get('per_page', 20) }}"
                   class="px-4 py-2 text-sm text-blue-500">Next</a>
            {% endif %}
        </div>

    </div>
</div>

<!-- JavaScript to handle row editing -->
<script>
    const staticUrl = "{{ url_for('static', filename='') }}";

</script>
<script src="{{ url_for('static', filename='js/table_main.js') }}">
    const staticUrl = "{{ url_for('static', filename='') }}";
    const CKEDITOR = window.CKEDITOR;
</script>
</body>
</html>

